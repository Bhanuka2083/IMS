{% extends "base.html" %}

{% block title %}Sale{% endblock %}


{% block content %}

<h1>Buy Items</h1>

<form method="POST">
    <label for="buyer_name">Buyer Name</label>
    <input type="text" id="buyer_name" name="buyer_name" class="form-control" placeholder="Enter buyer name" required>

    <label for="stock_id">Item:</label>
    <select id="stock_id" name="stock_id" class="form-control" required>
        <option value="">-- Choose an Item --</option>
        
        {% for stock in stocks %}
            <option value="{{ stock.id }}" data-price="{{ stock.selling_price }}"> 
                {{ stock.stock_name }} (Price: {{ stock.selling_price }})
            </option>
        {% endfor %}
        
    </select>

    <label for="item_count">Quantity</label>
    <input type="number" id="item_count" name="item_count" class="form-control" placeholder="Enter quantity" required min="1" value="1">

    <br>
    <br>
    <br>
    <br>
    <div class="d-flex" style="justify-content: space-between; margin: 0 auto; column-gap: 20px;">
        <br>
        <br>
        <h3>
            Total Price:
        </h3>
        <h3>
            $<span id="total_price_display">0.00</span> 
        </h3>
    </div>
    
    <br>
    <br>
    <br>
    <br>

    <div style="text-align: center;">
        <button type="submit" name="submit" id="submit" class="btn" style="background-color: #08a188; color: #ffffff; height: 50px; width: 150px; border-radius: 25px;"  >Buy Items</button>
    </div>
</form>

        <br>
        <br>
        <div style="text-align: center;">
            <a href="/"><button type="submit" name="submit" id="submit" class="btn" style="background-color: #08a188; color: #ffffff; height: 50px; width: 150px; border-radius: 25px;"  >Back to home</button></a>
        </div>



        <script>
            // 1. Get references to the key HTML elements
            const stockSelect = document.getElementById('stock_id');
            const quantityInput = document.getElementById('item_count');
            const totalPriceDisplay = document.getElementById('total_price_display');
        
            function calculateTotalPrice() {
                // 2. Get the currently selected option element
                const selectedOption = stockSelect.options[stockSelect.selectedIndex];
                
                // 3. Get the item's price from the 'data-price' attribute
                // Use parseFloat to ensure it's treated as a number
                const itemPrice = parseFloat(selectedOption.getAttribute('data-price')) || 0; 
                
                // 4. Get the quantity from the input field
                const quantity = parseInt(quantityInput.value) || 0;
        
                // 5. Calculate the total
                const total = itemPrice * quantity;
        
                // 6. Update the display element
                // Use .toFixed(2) to format the total to two decimal places (for currency)
                totalPriceDisplay.textContent = total.toFixed(2);
            }
        
            // 7. Attach the calculation function to the change events of the input fields
            stockSelect.addEventListener('change', calculateTotalPrice);
            quantityInput.addEventListener('input', calculateTotalPrice); // Use 'input' for real-time update as user types
        
            // Run the calculation once on page load to set the initial price (if an item is pre-selected)
            document.addEventListener('DOMContentLoaded', calculateTotalPrice);
        
        </script>


{% endblock %}
